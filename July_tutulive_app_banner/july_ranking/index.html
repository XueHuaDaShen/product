<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>july_ranking</title>
	<link rel="stylesheet" href="css/index.css">
</head>
<body>
	<div class="container">
		<div class="union_per_ranking">
			<header class="header">
				<img src="img/head2.png">
			</header>
			<div class="per_top">
				<div class="first">
					<div>
						<div class="firstImg">
							<img src="">
						</div>
						<img src="img/topThree1.png">
					</div>
					<p class="topThreeUnionName">BM</p>
				</div>
			</div>
			<ul class="per_ranking">
				
			</ul>
		</div>
		<header class="header">
			<img src="img/head.png">
		</header>
		<main class="main">
			<div class="contai">
				<div class="box">
					<div class="bj_shadow"></div>
				</div>
				<section class="section">
					<div class="topThree">
						<div class="second">
							<div>
								<img src="img/topThree2.png">
							</div>
							<p class="topThreeUnionName">BM</p>
						</div>
						<div class="first">
							<div>
								<div class="firstImg">
									<img src="" >
								</div>
								<img src="img/topThree1.png">
							</div>
							<p class="topThreeUnionName">BM</p>
						</div>
						<div class="third">
							<div>
								<img src="img/topThree3.png">
							</div>
							<p class="topThreeUnionName">BM</p>
						</div>
					</div>
					<ul class="list list1">
						<!-- <li>
							<div class="gold">
								<img src="img/ranking1.png" alt="">
								<em>1</em>
							</div>
							<div class="loginname">XO</div>
							<div class="yudan">1235498</div>
						</li>
						<li>
							<div class="gold">
								<img src="img/ranking1.png" alt="">
								<em>1</em>
							</div>
							<div class="loginname">XO</div>
							<div class="yudan">1235498</div>
						</li>
						<li>
							<div class="gold">
								<img src="img/ranking1.png" alt="">
								<em>1</em>
							</div>
							<div class="loginname">XO</div>
							<div class="yudan">1235498</div>
						</li>
						<li>
							<div class="gold">
								<img src="img/ranking1.png" alt="">
								<em>1</em>
							</div>
							<div class="loginname">XO</div>
							<div class="yudan">1235498</div>
						</li> -->
					</ul>
				</section>
			</div>
			<div class="text">
				<img src="img/t1.png">
			</div>
			<div class="week">
				<div class="weeked"><img src="img/week1ed.png"></div>
				<div><img src="img/week2.png"></div>
				<div><img src="img/week3.png"></div>
				<div><img src="img/week4.png"></div>
			</div>
			<div class="contai">
				<div class="box">
					<div class="bj_shadow"></div>
				</div>
				<section class="section">
					<div class="topThree">
						<div class="second">
							<div>
								<img src="img/topThree2.png">
							</div>
							<p class="topThreeUnionName">BM</p>
						</div>
						<div class="first">
							<div>
								<div class="firstImg">
									<img src="http://i1.live.aisoqu.com/kik.jpeg?imageView2/1/w/100/h/100" alt="">
								</div>
								<img src="img/topThree1.png">
							</div>
							<p class="topThreeUnionName">BM</p>
						</div>
						<div class="third">
							<div>
								<img src="img/topThree3.png">
							</div>
							<p class="topThreeUnionName">BM</p>
						</div>
					</div>
					<ul class="list list2">
						<!-- <li>
							<div class="gold">
								<img src="img/ranking2.png" alt="">
								<em>1</em>
							</div>
							<div class="loginname">XO</div>
							<div class="yudan">1235498</div>
						</li>
						<li>
							<div class="gold">
								<img src="img/ranking2.png" alt="">
								<em>1</em>
							</div>
							<div class="loginname">XO</div>
							<div class="yudan">1235498</div>
						</li>
						<li>
							<div class="gold">
								<img src="img/ranking2.png" alt="">
								<em>1</em>
							</div>
							<div class="loginname">XO</div>
							<div class="yudan">1235498</div>
						</li>
						<li>
							<div class="gold">
								<img src="img/ranking2.png" alt="">
								<em>1</em>
							</div>
							<div class="loginname">XO</div>
							<div class="yudan">1235498</div>
						</li> -->
					</ul>
				</section>
			</div>
			<div class="text">
				<img src="img/t2.png">
			</div>
			<div class="contai">
				<div class="box">
					<div class="bj_shadow"></div>
				</div>
				<section class="section">
					<div class="topThree">
						<div class="first">
							<div>
								<div class="firstImg">
									<img src="">
								</div>
								<img src="img/topThree1.png">
							</div>
							<p class="topThreeUnionName">BM</p>
						</div>
					</div>
					<ul class="gold_ranking">
						<!-- <li>
							<div class="1">
								<img src="img/second.png">
								<div class="first_img">
									<img src="http://i1.live.aisoqu.com/kik.jpeg?imageView2/1/w/100/h/100">
									<span>1</span>
								</div>
							</div>
							<p class="union_name">msgasg</p>
							<p class="yudan2">1213123</p>
						</li>
						<li>
							<div class="red">
								<img src="img/second.png">
								<div class="first_img">
									<img src="http://i1.live.aisoqu.com/kik.jpeg?imageView2/1/w/100/h/100">
									<span>1</span>
								</div>
							</div>
							<p class="union_name">msgasg</p>
							<p class="yudan2">1213123</p>
						</li>
						<li>
							<div class="red">
								<img src="img/second.png">
								<div class="first_img">
									<img src="http://i1.live.aisoqu.com/kik.jpeg?imageView2/1/w/100/h/100">
									<span>1</span>
								</div>
							</div>
							<p class="union_name">msgasg</p>
							<p class="yudan2">1213123</p>
						</li>
						<li>
							<div class="red">
								<img src="img/second.png">
								<div class="first_img">
									<img src="http://i1.live.aisoqu.com/kik.jpeg?imageView2/1/w/100/h/100">
									<span>1</span>
								</div>
							</div>
							<p class="union_name">msgasg</p>
							<p class="yudan2">1213123</p>
						</li> -->
					</ul>
				</section>
			</div>
		</main>
		<footer class="foot">
			<img src="img/foot.png" alt="">
		</footer>
	</div>


<script src="js/jquery-3.1.1.min.js"></script>
<script>
document.documentElement.style.fontSize = document.documentElement.clientWidth/7.5 + "px";

var clientWidth = document.documentElement.clientWidth;
var imgUrl = '?imageView2/1/w/100/h/100';
var flag = "first";
$(".bj_shadow").css({
	"height": $(".section").height()
})
function imgStyle(){
	$(".topThree>div>div").each(function(){
		$(this).css({
			"height": $(this).find(">img").width()
		})
	})
	$(".gold").each(function(){
		$(this).css({
			"height": $(this).width()
		})
	})
}
function imgStyle_p(){
	$(".per_top>div>div").each(function(){
		$(this).css({
			"height": $(this).find(">img").width()
		})
	})
	$(".per_ranking .gold").each(function(){
		$(this).css({
			"height": $(this).width()
		})
	})
}

$(".week>div").eq(0).on("click" ,function(){
	// var _time = new Date();
 //    if (_time*1 > (new Date('2017/06/30 23:59:59'))*1){
		$(this).addClass("weeked").siblings().removeClass("weeked");
		$(this).find("img").attr("src", "img/week1ed.png");
		$(".week>div").eq(1).find("img").attr("src", "img/week2.png");
		$(".week>div").eq(2).find("img").attr("src", "img/week3.png");
		$(".week>div").eq(3).find("img").attr("src", "img/week4.png");
		flag = 'first'
		yudan(flag)
    // }
})
$(".week>div").eq(1).on("click" ,function(){
	// var _time = new Date();
 //    if (_time*1 > (new Date('2017/07/06 23:59:59'))*1){
		$(this).addClass("weeked").siblings().removeClass("weeked");
		$(this).find("img").attr("src", "img/week2ed.png");
		$(".week>div").eq(0).find("img").attr("src", "img/week1.png");
		$(".week>div").eq(2).find("img").attr("src", "img/week3.png");
		$(".week>div").eq(3).find("img").attr("src", "img/week4.png");
		flag = 'second'
		yudan(flag)
    // }
})
$(".week>div").eq(2).on("click" ,function(){
	// var _time = new Date();
 //    if (_time*1 > (new Date('2017/07/13 23:59:59'))*1){
		$(this).addClass("weeked").siblings().removeClass("weeked");
		$(this).find("img").attr("src", "img/week3ed.png");
		$(".week>div").eq(0).find("img").attr("src", "img/week1.png");
		$(".week>div").eq(1).find("img").attr("src", "img/week2.png");
		$(".week>div").eq(3).find("img").attr("src", "img/week4.png");
		flag = 'third'
		yudan(flag)
    // }
})
$(".week>div").eq(3).on("click" ,function(){
	// var _time = new Date();
 //    if (_time*1 > (new Date('2017/07/20 23:59:59'))*1){
		$(this).addClass("weeked").siblings().removeClass("weeked");
		$(this).find("img").attr("src", "img/week4ed.png");
		$(".week>div").eq(0).find("img").attr("src", "img/week1.png");
		$(".week>div").eq(1).find("img").attr("src", "img/week2.png");
		$(".week>div").eq(2).find("img").attr("src", "img/week3.png");
		flag = 'fourth'
		yudan(flag)
  //   }
})

$(document).on("click", ".list2>li>div", function(){
	var id = $(this).attr("data-id");
	follow(id)
})
$(document).on("click", ".per_ranking>li>div", function(){
	var id = $(this).attr("data-id");
	follow(id)
})
$(document).on("click", ".gold_ranking>li>div", function(){
	var id = $(this).attr("data-id");
	follow(id)
})

function follow(loginid) {
    // alert("follow");
    var query_data = {};
    query_data.loginid = loginid;
    if (window.webkit == null) {
        window.JSBridge.invoke('follow', JSON.stringify(query_data));
        window.JSBridge.invoke('user_profile', JSON.stringify(query_data));
    } else {
        window.webkit.messageHandlers.JSBridge.postMessage(['invoke', 'follow', JSON.stringify(query_data)]);
    }
}

function bind_union_per_ranking(){
	$(document).on("click", ".list1>li>.gold", function(){
		var id = $(this).attr("data-id");
		var src = $(this).attr("data-src");
		var name = $(this).next().next().html();
		scrollNum = $(document).scrollTop();
		per(id, src, name);
		$(".union_per_ranking").show().siblings().hide()
	    $(".per_top>div").each(function(){
		    $(this).css({
			    "height": $(this).width()+"px"
		    })
	    })
	})
}
$(".union_per_ranking").on("click", function(){
	var that = this;
	// $("union_ranking").html("");
	// $("anchor_ranking").html("");
	// $("gold_ranking").html("");
	// union();
	setTimeout(function(){
		$(that).hide().siblings().show();
	}, 200)
	$(document).scrollTop(scrollNum);
	// yudan('first');
	// gold('first');
})
function union(){
	$.ajax({
		url: 'https://dee.tutulive.tv:8446/api/v1/man/activity/common/union/rank',//'http://52.77.61.48:8040/api/v1/bi/union/ranking',
        method: 'get',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
            //'token': token
        },
        data: {
        	"date": "2017-06",
        	"type": "June"
        },
        success: function(data){
        	var str = '';
        	var _style = '';
        	var avatarurl = '';
        	var firstavatar = '';
        	var secondavatar = '';
        	var thirdavatar = '';
        	var data = data.data;
        	var img_url3 = '';
        	var em = '';
        	// console.log(data)
        	if( data == "" || data === "" ){
        		$(".list1").html("暂无数据").css({
        			"text-align": "center",
        			"color": "#fff"
        		});
        		$(".bj_shadow").eq(0).css("height", $(".section").eq(0).height());

				$(".topThree").eq(0).find(".first>div>div>img").attr("src", '');
				$(".topThree").eq(0).find(".first>p").text()

				$(".topThree").eq(0).find(".second>div").css({
					"background": 'none',
					"background-size": '0'
				})
				$(".topThree").eq(0).find(".second>p").text()

				$(".topThree").eq(0).find(".third>div").css({
					"background": 'none',
					"background-size": '0'
				})
				$(".topThree").eq(0).find(".third>p").text()
        	}else{
        		//工会前三名
        		if( data[0].avatar.indexOf("i1.live.aisoqu.com") > -1 ){
        			firstavatar = imgUrl;
        		}else{
        			firstavatar = '';
        		}
        		if( data[1].avatar.indexOf("i1.live.aisoqu.com") > -1 ){
        			secondavatar = imgUrl;
        		}else{
        			secondavatar = '';
        		}
        		if( data[2].avatar.indexOf("i1.live.aisoqu.com") > -1 ){
        			thirdavatar = imgUrl;
        		}else{
        			thirdavatar = '';
        		}
        		$(".bj_shadow").eq(0).css("height", $(".section").eq(0).height());
				$(".topThree").eq(0).find(".first>div>div>img").attr("src", data[0].avatar+firstavatar);
				$(".topThree").eq(0).find(".first>p").text(data[0].unionname)

				$(".topThree").eq(0).find(".second>div").css({
					"background": 'url('+data[1].avatar+secondavatar+') no-repeat',
					"background-size": 'cover'
				})
				$(".topThree").eq(0).find(".second>p").text(data[1].unionname)

				$(".topThree").eq(0).find(".third>div").css({
					"background": 'url('+data[2].avatar+thirdavatar+') no-repeat',
					"background-size": 'cover'
				})
				$(".topThree").eq(0).find(".third>p").text(data[2].unionname)


	        	for (var i = 0; i < data.length; i++){
	        		if( i > 8 ){
	        			em = 'em';
	        		}
	        		if( i == 0 ){
	        			_style = "first";
	        		}else{
	        			_style = 'second';
	        		}
	        		if( data[i].avatar.indexOf('i1.live.aisoqu.com') > -1 ){
	        			avatarurl = imgUrl;
	        		}else{
	        			avatarurl = '';
	        		}
	        		if( data[i].avatar ){
                        img_url3 = 'background:url('+data[i].avatar+avatarurl+') no-repeat;background-size: cover;';
                    }else{
                        img_url3 = '';
                    }
	        		str += '<li><div class="gold" style="'+img_url3+'" data-id="'+data[i].unionid+'" data-src="'+data[i].avatar+avatarurl+'"><img src="img/ranking1.png" alt=""><em class="'+em+'">'+(i+1)+'</em></div><div class="loginname">'+data[i].unionname+'</div><div class="yudan">'+data[i].range+'</div></li>';
	        	}

	        	$(".list1").html(str);
	        	imgStyle();
				setTimeout(function(){
					// $(".bj_union").css("height", $(".union_section").height());
					$(".bj_shadow").eq(0).css({
						"height": $(".section").eq(0).height()
					})
				}, 200)
				bind_union_per_ranking();

        	}
        	
        }
	})
}
union();
function per(id, src, name){
	$.ajax({
		url: 'https://dee.tutulive.tv:8446/api/v1/man/activity/common/union/personal/list',//'http://52.77.61.48:8040/api/v1/bi/union/host/coins/ranking',
        method: 'get',
        data: {
        	"date": "2017-06",
        	"type": "June",
        	"unionid": id
        },
        success: function(data){
        	var str = '';
        	var _style = '';
        	var _style2 = '';
        	var avatarurl = '';
        	var data = data.data;
        	var em = '';
        	// console.log(data)
        	if( data == "" || data === "" ){
        		$(".per_ranking").html("暂无数据").css({
        			"text-align": "center",
        			"color": "#fff"
        		});

				$(".per_top").find(".first>div>div>img").attr("src", '');
				$(".per_top").find(".first>p").text()
        	}else{
        		//工会
        		$(".per_top").find(".first>div>div>img").attr("src", src);
				$(".per_top").find(".first>p").text(name)

	        	for (var i = 0; i < data.length; i++){
	        		if( i > 8 ){
	        			em = 'em';
	        		}
	        		if( i == 0 ){
	        			_style = "first";
	        		}else{
	        			_style = 'second';
	        		}
	        		if( data[i].avatar.indexOf('i1.live.aisoqu.com') > -1 ){
	        			avatarurl = imgUrl;
	        		}else{
	        			avatarurl = '';
	        		}
	        		if( data[i].avatar ){
                        img_url3 = 'background:url('+data[i].avatar+avatarurl+') no-repeat;background-size: cover;';
                    }else{
                        img_url3 = '';
                    }
	        		str += '<li><div class="gold" data-id="'+data[i].loginid+'" style="'+img_url3+'" data-id="'+data[i].unionid+'" data-src="'+data[i].avatar+avatarurl+'"><img src="img/ranking2.png" alt=""><em class="'+em+'">'+(i+1)+'</em></div><div class="loginname">'+data[i].loginname+'</div><div class="yudan">'+data[i].coins+'</div></li>';
	        	}

	        	$(".per_ranking").html(str);
	        	imgStyle_p();
	        	// img_style_p();
	        	// li_style_p();
        	}
        	
        }
	})
}



yudan(flag)
function yudan(flag){
	$.ajax({
		url: 'https://dee.tutulive.tv:8446/api/v1/man/activity/common/host/rank',//'http://52.77.61.48:8040/api/v1/bi/union/host/coins/ranking',
        method: 'get',
        data: {
            "date": "2017-06",
        	"type": "June",
        	"flag": flag
        },
        success: function(data){
        	var str = '';
        	var _style = '';
        	var _style2 = '';
        	var _style_img = '';
        	var avatarurl = '';
        	var firstavatar = '';
        	var secondavatar = '';
        	var thirdavatar = '';
        	var data = data.data;
        	var img_url3 = '';
        	var em = '';
        	if( data == "" || data === "" ){
        		$(".list2").html("暂无数据").css({
        			"text-align": "center",
        			"color": "#fff"
        		});
        		$(".bj_shadow").eq(1).css("height", $(".section").eq(1).height());

				$(".topThree").eq(1).find(".first>div>div>img").attr("src", '');
				$(".topThree").eq(1).find(".first>p").text()

				$(".topThree").eq(1).find(".second>div").css({
					"background": 'none',
					"background-size": '0'
				})
				$(".topThree").eq(1).find(".second>p").text()

				$(".topThree").eq(1).find(".third>div").css({
					"background": 'none',
					"background-size": '0'
				})
				$(".topThree").eq(1).find(".third>p").text()
        	}else{
        		//鱼蛋前三名
        		if( data[0].avatar.indexOf("i1.live.aisoqu.com") > -1 ){
        			firstavatar = '?imageView2/1/w/100/h/100';
        		}else{
        			firstavatar = '';
        		}
        		if( data[1].avatar.indexOf("i1.live.aisoqu.com") > -1 ){
        			secondavatar = '?imageView2/1/w/100/h/100';
        		}else{
        			secondavatar = '';
        		}
        		if( data[2].avatar.indexOf("i1.live.aisoqu.com") > -1 ){
        			thirdavatar = '?imageView2/1/w/100/h/100';
        		}else{
        			thirdavatar = '';
        		}
        		$(".bj_shadow").eq(1).css("height", $(".section").eq(1).height());
				$(".topThree").eq(1).find(".first>div>div>img").attr("src", data[0].avatar+firstavatar);
				$(".topThree").eq(1).find(".first>p").text(data[0].loginname)

				$(".topThree").eq(1).find(".second>div").css({
					"background": 'url('+data[1].avatar+secondavatar+') no-repeat',
					"background-size": 'cover'
				})
				$(".topThree").eq(1).find(".second>p").text(data[1].loginname)

				$(".topThree").eq(1).find(".third>div").css({
					"background": 'url('+data[2].avatar+thirdavatar+') no-repeat',
					"background-size": 'cover'
				})
				$(".topThree").eq(1).find(".third>p").text(data[2].loginname)

	        	for (var i = 0; i < data.length; i++){
	        		if( i > 8 ){
	        			em = 'em';
	        		}
	        		if( data[i].avatar.indexOf('i1.live.aisoqu.com') > -1 ){
	        			avatarurl = '?imageView2/1/w/100/h/100';
	        		}else{
	        			avatarurl = '';
	        		}
	        		if( data[i].avatar ){
                        img_url3 = 'background:url('+data[i].avatar+avatarurl+') no-repeat;background-size: cover;';
                    }else{
                        img_url3 = '';
                    }
	        		str += '<li><div class="gold" data-id="'+data[i].loginid+'" style="'+img_url3+'"><img src="img/ranking1.png" alt=""><em class="'+em+'">'+(i+1)+'</em></div><div class="loginname">'+data[i].loginname+'</div><div class="yudan">'+data[i].coins+'</div></li>';
	        	}

	        	$(".list2").html(str);
	        	imgStyle();
				setTimeout(function(){
					$(".bj_shadow").eq(1).css({
						"height": $(".section").eq(1).height()
					})
				},200)
				// img_style_m();
				// bind_union_per_ranking();
        	}
        	// console.log(data)
        	
        }
	})
}

function gold(){
	$.ajax({
		url: 'https://dee.tutulive.tv:8446/api/v1/man/activity/common/consume/rank',//'http://52.77.61.48:8040/api/v1/bi/fan/ranking',
        method: 'get',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
            //'token': token
        },
        data: {
            "date": "2017-06"
        },
        success: function(data){
        	var str = '';
        	var _style = '';
        	var _style2 = '';
        	var avatarurl = '';
        	var data = data.data;
        	if( data == "" || data === "" ){
	        	$(".gold_ranking").html("暂无数据").css({
        			"text-align": "center",
        			"color": "#fff"
        		});
				$(".bj_shadow").eq(2).css("height", $(".section").eq(2).height());
				$(".topThree").eq(2).find(".first>div>div>img").attr("src", '');
				$(".topThree").eq(2).find(".first>p").text()
        	}else{
        		//金主第一名
	        	if( data[0].avatar.indexOf('i1.live.aisoqu.com') > -1 ){
	        		$(".topThree").eq(2).find(".first>div>div>img").attr("src", data[0].avatar+imgUrl);
	        	}else{
	        		$(".topThree").eq(2).find(".first>div>div>img").attr("src", data[0].avatar);
	        	}
				$(".topThree").eq(2).find(".first>p").text(data[0].loginname)

	        	for (var i = 0; i < 5; i++){
	        		if( i == 0 ){
	        			_style = "first";
	        		}else{
	        			// _style2 = '_third';
	        			_style = 'red';
	        		}
	        		if( data[i].avatar.indexOf('i1.live.aisoqu.com') > -1 ){
	        			avatarurl = '?imageView2/1/w/100/h/100';
	        			console.log(i)
	        		}else{
	        			avatarurl = '';
	        		}
	        		str += '<li><div class="'+_style+'" data-id="'+data[i].loginid+'"><img src="img/second.png"><div class="first_img"><img src="'+data[i].avatar+avatarurl+'"><span>'+(i+1)+'</span></div></div><p class="union_name">'+data[i].loginname+'</p><p class="yudan2">'+data[i].diamonds+'</p></li>';
	        		// str += '<li><div class="'+_style+' '+_style2+'"><img src="img/second.png"><div class="'+_style+'_img"><img src="'+data[i].avatar+avatarurl+'" data-id="'+data[i].loginid+'"><span><img src="img/'+(i+1)+'.png"/></span></div></div><p class="union_name">'+data[i].loginname+'</p><p class="yudan">'+data[i].diamonds+'</p></li>';
	        	}

	        	$(".gold_ranking").html(str);
	        	// li_style_m();
				setTimeout(function(){
					// $(".bj_gold").css("height", $(".gold_section").height());
					$(".bj_shadow").eq(2).css({
						"height": $(".section").eq(2).height()
					})
				},200)
				// img_style_m();
        	}
        	// console.log(data);
        	
        }
	})
}
gold()
function li_style_m(){
	$(".main li>div").each(function(){
		$(this).css({
			"height": $(this).width()+"px"
		})
	})
}
</script>	
</body>
</html>
